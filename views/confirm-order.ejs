<%- include('partials/header') %>

<div class="container my-5" style="max-width: 1000px;">
  <h2 class="text-center mb-5 fw-bold" style="color:#7c3aed;">تأیید نهایی سفارش</h2>

  <div class="row g-4">

    <!-- خلاصه سفارش -->
    <div class="col-12 col-lg-7">
      <div class="card shadow-sm border-0" style="border-top:4px solid #c4b5fd;">
        <div class="card-body dir-rtl">
          <h5 class="card-title mb-4 text-purple fw-bold">خلاصه سفارش</h5>

          <% cart.items.forEach(item => { %>
            <div class="d-flex align-items-start mb-4 p-3 shadow-sm" style="border-radius:12px; background:#faf8ff;">
              <div style="width:90px; height:90px; flex:0 0 90px; margin-left:14px;">
                <% if (item.imageUrl) { %>
                  <img src="<%= item.imageUrl %>" alt="<%= item.name %>" style="width:100%; height:100%; object-fit:cover; border-radius:10px; border:2px solid #ddd;">
                <% } else { %>
                  <div style="width:100%; height:100%; background:#f1f1f1; display:flex; align-items:center; justify-content:center; border-radius:8px;">
                    <small class="text-muted">بدون تصویر</small>
                  </div>
                <% } %>
              </div>

              <div class="flex-grow-1">
                <h6 class="mb-2 fw-bold"><%= item.name %></h6>
                <div class="small text-muted mb-2">قیمت واحد: 
                  <span class="text-dark fw-semibold"><%= Number(item.unitPrice || 0).toLocaleString() %></span> تومان 
                  — هر بسته: <%= item.packSize %> واحد
                </div>

                <!-- نمایش انتخاب‌های رنگی -->
                <div>
                  <% item.selections.forEach(sel => { %>
                    <div class="d-flex justify-content-between align-items-center mb-2 bg-white px-2 py-1 rounded-3 border" style="border-color:#ede9fe;">
                      <div>
                        <span class="badge bg-light text-dark me-2" style="display:inline-flex;align-items:center">
                          <span style="display:inline-block;width:12px;height:12px;border-radius:50%;background:<%= sel.colorCode || '#ccc' %>;margin-inline-start:6px;border:1px solid #ddd;"></span>
                          <strong><%= sel.color %></strong>
                        </span>
                        <small class="text-muted"> — بسته: <%= sel.packs %></small>
                        <small class="text-muted"> (واحد: <%= sel.units %>)</small>
                      </div>
                      <div class="text-end">
                        <small class="text-muted">جزء: </small>
                        <div class="fw-bold text-success"><%= Number(sel.subtotal || 0).toLocaleString() %> تومان</div>
                      </div>
                    </div>
                  <% }) %>
                </div>
              </div>
            </div>
          <% }) %>

          <hr class="mt-4">

          <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
              <small class="text-muted">تعداد آیتم‌ها: <strong><%= cart.items.length %></strong></small>
            </div>
            <div class="text-end">
              <div class="h5 mb-0">جمع کل: 
                <span class="text-purple fw-bold"><%= Number(cart.total || cart.items.reduce((s,it)=>s+(it.totalPrice||0),0)).toLocaleString() %> تومان</span>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

        <!-- اطلاعات گیرنده -->
    <div class="col-12 col-lg-5">
      <div class="card shadow-sm border-0" style="border-top:4px solid #a78bfa;">
        <div class="card-body dir-rtl" >
          <h5 class="card-title mb-3 text-purple fw-bold">مشخصات گیرنده</h5>
          <p class="mb-1"><strong>نام:</strong> <%= user.firstName %> <%= user.lastName %></p>
          <p class="mb-1"><strong>تلفن:</strong> <%= user.mobile || '-' %></p>
          <p class="mb-1"><strong>ایمیل:</strong> <%= user.email || '-' %></p>
          <hr>
          <p class="mb-1"><strong>آدرس:</strong></p>
          <p class="text-muted"><%= user.address || '-' %></p>
          <p class="mb-0"><strong>کدپستی:</strong> <%= user.postalCode || '-' %></p>
        </div>
      </div>
    </div>
    
  </div>


  <!-- دکمه ثبت -->
  <div class="row mt-3 g-2 ">  
    <div class="col-12 col-md-3">
      <form action="/confirm-order" method="POST">
        <button type="submit" class="btn btn-purple w-100 py-2 fw-bold">ثبت نهایی سفارش و پرداخت</button>
      </form>
    </div>
    <div class="col-12 col-md-3">
      <a href="/checkout" class="btn btn-outline-purple w-100 fw-bold">بازگشت و ویرایش اطلاعات</a>
    </div>
  </div>




</div>

<style>
  .text-purple { color:#7c3aed; }
  .btn-purple {
    background-color:#8b5cf6;
    border:none;
    color:white;
    transition: all 0.3s ease;
  }
  .btn-purple:hover {
    background-color:#6d28d9;
  }
  .btn-outline-purple {
    color:#7c3aed;
    border:1px solid #7c3aed;
    transition: all 0.3s ease;
  }
  .btn-outline-purple:hover {
    background-color:#7c3aed;
    color:#fff;
  }
</style>


<%- include('partials/footer') %>
