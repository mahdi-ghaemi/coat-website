<%- include('../partials/header') %>

<div class="container my-5">
  <h3 class="mb-4">๐ฆ ุฌุฒุฆุงุช ุณูุงุฑุด</h3>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">๐ค ุงุทูุงุนุงุช ุฎุฑุฏุงุฑ</h5>
      <p><strong>ูุงู:</strong> <%= order.firstName %> <%= order.lastName %></p>
      <p><strong>ุชููู:</strong> <%= order.userId?.mobile || '-' %></p>
      <p><strong>ุขุฏุฑุณ:</strong> <%= order.address || '-' %></p>
      <p><strong>ฺฉุฏูพุณุช:</strong> <%= order.postalCode || '-' %></p>
      <p><strong>ุชุงุฑุฎ ุณูุงุฑุด:</strong> <%= new Date(order.createdAt).toLocaleString('fa-IR') %></p>
      <p><strong>ฺฉุฏ ุณูุงุฑุด:</strong> <%= order.orderCode %></p>
      <p><strong>ูุถุนุช:</strong> <%= order.status %></p>
    </div>
  </div>

  <h5 class="mb-3">๐ ุงููุงู ุณูุงุฑุด</h5>
  <% order.items.forEach((item, i) => { %>
    <div class="card mb-3 border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-start">
          <div style="width:80px; height:80px; margin-left:15px;">
            <% if (item.imageUrl) { %>
              <img src="<%= item.imageUrl %>" alt="<%= item.name %>" style="width:100%; height:100%; object-fit:cover; border-radius:8px;">
            <% } else { %>
              <div style="width:100%; height:100%; background:#f1f1f1; display:flex; align-items:center; justify-content:center; border-radius:8px;">
                <small class="text-muted">ุจุฏูู ุชุตูุฑ</small>
              </div>
            <% } %>
          </div>

          <div class="flex-grow-1">
            <h6 class="fw-bold mb-2"><%= item.name %></h6>
            <p class="mb-1 text-muted">ููุช ูุงุญุฏ: <%= Number(item.unitPrice || 0).toLocaleString() %> ุชููุงู</p>
            <p class="mb-1 text-muted">ุชุนุฏุงุฏ ฺฉู: <%= item.totalPacks || 0 %> ุนุฏุฏ</p>
            <p class="mb-1 text-muted">ุฌูุน ุฌุฒุก: <%= Number(item.totalPrice || 0).toLocaleString() %> ุชููุงู</p>

            <% if (item.selections && item.selections.length > 0) { %>
              <div class="mt-3">
                <strong>ุฑูฺฏโูุง:</strong>
                <% item.selections.forEach(sel => { %>
                  <div class="p-2 mt-2 bg-light rounded border">
                    <span style="display:inline-block;width:12px;height:12px;border-radius:50%;background:<%= sel.colorCode || '#ccc' %>;border:1px solid #999;margin-left:6px;"></span>
                    <%= sel.color %> โ
                    <small>ุชุนุฏุงุฏ ูุงุญุฏ: <%= sel.units %></small> โ
                    <small>ุจุณุชู: <%= sel.packs %></small> โ
                    <small>ููุช ุฌุฒุก: <%= Number(sel.subtotal || 0).toLocaleString() %> ุชููุงู</small>
                  </div>
                <% }) %>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  <% }) %>

  <div class="text-end mt-4">
    <h5>๐ฐ ุฌูุน ฺฉู: <span class="text-success"><%= Number(order.total).toLocaleString() %> ุชููุงู</span></h5>
  </div>




  <hr class="my-4">



    <!-- ุฏุฑ ุณุฑูุฑ ุงุถุงูู ุดูุฏ -->
      <div class="row mt-3 g-2 ">  
        <div class="col-12 col-md-4">
          
          <div class="row">
            <form action="/admin/orders/<%= order._id %>/status" method="POST" class="d-flex">
              
              <div class="col-6">
                <select name="status" class="form-select w-100 py-2">
                    <option value="ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฎุช" <%= order.status === 'ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฎุช' ? 'selected' : '' %>>ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฎุช</option>
                    <option value="ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ" <%= order.status === 'ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ' ? 'selected' : '' %>>ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ</option>
                    <option value="ุงุฑุณุงู ุดุฏู" <%= order.status === 'ุงุฑุณุงู ุดุฏู' ? 'selected' : '' %>>ุงุฑุณุงู ุดุฏู</option>
                    <option value="ุชุญูู ุฏุงุฏู ุดุฏู" <%= order.status === 'ุชุญูู ุฏุงุฏู ุดุฏู' ? 'selected' : '' %>>ุชุญูู ุฏุงุฏู ุดุฏู</option>
                    <option value="ูุบู ุดุฏู" <%= order.status === 'ูุบู ุดุฏู' ? 'selected' : '' %>>ูุบู ุดุฏู</option>
                </select>
              </div>

              <div class="col-6">
                <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">ุชุบุฑ ูุถุนุช</button>
              </div>

            </form>
          </div>

        </div>

        <div class="col-12 col-md-2">
          <form action="/admin/orders/<%= order._id %>?_method=DELETE" method="POST" >
             <button type="submit" class="btn btn-danger w-100 py-2 fw-bold" onclick="return confirm('ุขุง ุงุฒ ุญุฐู ุงู ุณูุงุฑุด ูุทูุฆู ูุณุชุฏุ')">ุญุฐู ุณูุงุฑุด</button>
          </form>
        </div>

        <div class="col-12 col-md-2">
          <a href="/admin/orders/<%= order._id %>/invoice" target="_blank" class="btn btn-outline-success w-100 py-2 fw-bold">
              ฺุงูพ ูุงฺฉุชูุฑ PDF
          </a>
        </div>


      </div>
    <!-- ุฏุฑ ุณุฑูุฑ ุงุถุงูู ุดูุฏ -->



    <a href="/admin/users/<%= order.userId?._id %>" class="btn btn-outline-secondary mt-4">ุจุงุฒฺฏุดุช</a>


</div>

<%- include('../partials/footer') %>
